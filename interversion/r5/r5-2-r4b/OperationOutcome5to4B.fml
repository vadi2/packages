/// url = 'http://hl7.org/fhir/StructureMap/OperationOutcome5to4B'
/// name = 'OperationOutcome5to4B'
/// title = 'FML Conversion for OperationOutcome: R5 to R4B'

conceptmap "IssueSeverity" {
  prefix s = "http://hl7.org/fhir/issue-severity"
  prefix t = "http://hl7.org/fhir/4.3/issue-severity"

  s:"fatal" - t:"fatal"
  s:"error" - t:"error"
  s:"warning" - t:"warning"
  s:"information" - t:"information"
  s:"success" - t:"success"
}

conceptmap "IssueType" {
  prefix s = "http://hl7.org/fhir/issue-type"
  prefix t = "http://hl7.org/fhir/4.3/issue-type"

  s:"invalid" - t:"invalid"
  s:"security" - t:"security"
  s:"processing" - t:"processing"
  s:"transient" - t:"transient"
  s:"informational" - t:"informational"
  s:"success" - t:"success"
}

uses "http://hl7.org/fhir/StructureDefinition/OperationOutcome" alias OperationOutcomeR5 as source
uses "http://hl7.org/fhir/4.3/StructureDefinition/OperationOutcome" alias OperationOutcomeR4B as target

imports "http://hl7.org/fhir/StructureMap/*5to4B"

group OperationOutcome(source src : OperationOutcomeR5, target tgt : OperationOutcomeR4B) extends DomainResource <<type+>> {
  src.issue as s -> tgt.issue as t then OperationOutcomeIssue(s,t);
}

group OperationOutcomeIssue(source src, target tgt) extends BackboneElement {
  src.severity as v -> tgt.severity = translate(v, '#IssueSeverity', 'code');
  src.code as v -> tgt.code = translate(v, '#IssueType', 'code');
  src.details -> tgt.details;
  src.diagnostics -> tgt.diagnostics;
  src.location -> tgt.location;
  src.expression -> tgt.expression;
}

